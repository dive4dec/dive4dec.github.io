"use strict";(self.webpackChunk_deathbeds_ipydrawio=self.webpackChunk_deathbeds_ipydrawio||[]).push([[883],{527:(t,e,a)=>{a.r(e),a.d(e,{MIME_CLASS:()=>l,RenderedDiagram:()=>d,default:()=>m,extensions:()=>c});var s=a(992),n=a(656),r=a(97),i=a(649),o=a(698);const l="jp-DiagramMedia",c=n.WY.map((t=>{const{name:e}=t;return{id:`${r.NS}:rendermime-${e}`,name:e,rendererFactory:{safe:!0,mimeTypes:[t.mimetype],createRenderer:e=>(r.eM&&console.error("creating renderer"),new d(Object.assign(Object.assign({},e),{format:t})))},dataType:"string"}})),m=c;class d extends s.Panel{constructor(t){super(),this.initialized=!1,this.addClass(l),this.format=t.format,this.content=new i.S({adapter:{format:()=>this.format,urlParams:()=>{var t,e,a;let s={};const{manager:n}=d;null!=n&&(s=(null===(e=null===(t=n.settings)||void 0===t?void 0:t.composite)||void 0===e?void 0:e.drawioUrlParams)||{});const r=((null===(a=this.lastModel)||void 0===a?void 0:a.metadata)[this.format.mimetype]||{}).drawioUrlParams;return null!=r&&(s=Object.assign(Object.assign({},s),r)),s},drawioUrl:()=>o.DRAWIO_URL,saveNeedsExport:()=>{var t;return(null===(t=this.format)||void 0===t?void 0:t.isTransformed)||!0},drawioConfig:()=>{var t,e,a;let s={};const{manager:n}=d;null!=n&&(s=(null===(e=null===(t=n.settings)||void 0===t?void 0:t.composite)||void 0===e?void 0:e.drawioConfig)||{});const r=((null===(a=this.lastModel)||void 0===a?void 0:a.metadata)[this.format.mimetype]||{}).drawioConfig;return null!=r&&(s=Object.assign(Object.assign({},s),r)),s},toXML:()=>{var t;return null==this.lastModel?"":(null===(t=this.lastModel.data[this.format.mimetype])||void 0===t?void 0:t.toString())||""},fromXML:()=>{}}}),this.layout.addWidget(this.content)}onAfterShow(){this.initialized||(this.content.onAfterShow(),this.initialized=!0),this.content.onContentChanged()}async renderModel(t){const e=t.metadata||{},a=e?e[this.format.mimetype]:null;if(null!=a){const t=a.height?`${a.height}`:"";this.node.style.minHeight=t}this.lastModel=t,this.initialized?this.content.onContentChanged():this.isVisible?this.onAfterShow():setTimeout((()=>this.onAfterShow()),100)}}},883:(t,e,a)=>{a.r(e),a.d(e,{default:()=>D});var s=a(140),n=a(992),r=a(493),i=a(991),o=a(921),l=a(7),c=a(250),m=a(74),d=a(656),h=a(271),u=a.n(h);function p(t){var e;return(null===(e=t.status)||void 0===e?void 0:e.length)?u().createElement(s.TextItem,{onClick:t.handleClick,source:`drawio: ${t.status||"ready"}`,title:"TBDâ€¦"}):u().createElement("span",null)}class g extends i.VDomRenderer{constructor(t){super(t),this._popup=null,this.addClass(s.interactiveItem)}render(){return null==this.model?null:u().createElement(p,{handleClick:()=>this._handleClick(),status:this.model.status})}_handleClick(){const t=this._menu;this._popup&&this._popup.dispose(),t.aboutToClose.connect(this._menuClosed,this),this._popup=(0,s.showPopup)({body:t,anchor:this,align:"right"})}_menuClosed(){this.removeClass(s.clickedItem)}}!function(t){class e extends i.VDomModel{constructor(){super(...arguments),this._status=""}get status(){return this._status}set status(t){this._status!=t&&(this._status=t,this.stateChanged.emit(void 0))}}t.Model=e}(g||(g={}));var f=a(97),w=a(840),_=a(526),y=a(19),v=a(367),b=a(698);const x="jp-IPyDiagram-cards",C={label:"blank",url:"",thumbnail:"",tags:[]},E=["pages","layers"],$=["dark"],T=["light"];let F={kennedy:[...E,...T],dark:[...E,...$],sketch:[...E,...T,...$],min:[...E,...T,...$],atlas:[...E,...T]};class k extends i.VDomRenderer{constructor(t){super(t),this.onSearch=t=>{this.model.templateSearchText=t.currentTarget.value},this.renderFormat=(t,e)=>{const a=`ipydrawio-format-${t.name}`;let s=[];return t.isBinary&&s.push("binary"),t.isText&&s.push("text"),t.isJson&&s.push("json"),h.createElement("li",{key:t.name,"data-ipydrawio-format":t.ext},h.createElement("input",{type:"radio",name:"ipydrawio-format",id:a,onChange:()=>this.model.format=t,defaultChecked:!e}),h.createElement("label",{htmlFor:a},h.createElement("code",null,t.ext),h.createElement(t.icon.react,{width:100,tag:"span"}),this.renderTags(s)))},this.renderTheme=(t,e=-1)=>{const a=t||this.model.settingsUi,s=d.sc[a],n=`ipydrawio-theme-${e}`,r=[...F[a],...t?[]:["default"]];return h.createElement("li",{key:t,"data-ipydrawio-theme":t},h.createElement("input",{type:"radio",name:"ipydrawio-theme",id:n,onChange:()=>this.model.ui=t,defaultChecked:-1===e}),h.createElement("label",{htmlFor:n},`${a} ${t?"":"(default)"}`,h.createElement(s.react,{width:100,tag:"span"}),this.renderTags(r)))},this.renderTemplate=(t,e=-1)=>{const a=`ipydrawio-template-${e}`;return h.createElement("li",{key:t.url||"__blank__","data-ipydrawio-template":t.url},h.createElement("input",{type:"radio",name:"ipydrawio-template",id:a,value:t.url,onChange:()=>this.model.template=t,defaultChecked:-1===e}),h.createElement("label",{htmlFor:a},t.label,t.thumbnail?h.createElement("img",{src:t.thumbnail}):[],this.renderTags(t.tags||[])))},this.renderTag=t=>h.createElement("li",{key:t},t),this.title.icon=d.EH,this.title.label="New Diagram",this.addClass("jp-IPyDiagram-CreateCustom"),this.addClass("jp-RenderedHTMLCommon")}render(){var t;const e=d.sc[this.model.ui||this.model.settingsUi];let a=(null===(t=this.model.template)||void 0===t?void 0:t.label)||C.label;return a=`${a} ${this.model.format.ext}`,[h.createElement("header",{key:"header"},h.createElement("h1",null,"New Diagram"),h.createElement("label",null,this.model.cwd?h.createElement("pre",null,"/",this.model.cwd,"/"):""),h.createElement("input",{type:"text",className:"jp-mod-styled",defaultValue:this.model.name,placeholder:"untitled",onChange:t=>this.model.name=t.currentTarget.value}),h.createElement("label",null,h.createElement("pre",null,this.model.format.ext)),h.createElement("button",{onClick:this.model.requestDocument,type:"button",className:"jp-mod-styled jp-mod-accept"},h.createElement(e.react,{width:24,tag:"span"}),h.createElement("label",null,"NEW ",a.toLocaleUpperCase()))),h.createElement("form",{key:"form"},this.renderFormats(),this.renderThemes(),this.renderTemplates())]}renderFormats(){return h.createElement("section",null,h.createElement("h2",null,"Format"),h.createElement("ul",{className:x},this.model.formats.map(this.renderFormat)))}renderThemes(){return h.createElement("section",null,h.createElement("h2",null,"Theme"),h.createElement("ul",{className:x},this.renderTheme(null,-1),f.oP.map(this.renderTheme)))}renderTemplates(){return h.createElement("section",null,h.createElement("h2",null,"Template"," ",h.createElement("input",{type:"text",className:"jp-mod-styled",onChange:this.onSearch,title:"Search Templates",placeholder:"Search Templates"})),h.createElement("ul",{className:x},this.renderTemplate(C,-1),this.model.templates.map(this.renderTemplate)))}renderTags(t){return h.createElement("ul",{className:"jp-IPyDiagram-tags"},t.map(this.renderTag))}}!function(t){class e extends i.VDomModel{constructor(t){super(),this._templates=[],this._templateSearchText="",this._documentRequested=new w.Signal(this),this._format=d.Fl,this._name="",this._cwd=null,this.requestDocument=()=>{this._documentRequested.emit(void 0)},this._manager=t.manager,this._cwd=t.cwd||null,this._manager.templates().then((t=>{this._templates=t,this.stateChanged.emit(void 0)})).catch(console.warn)}get args(){return{name:this._name,format:this._format.key,drawioUrlParams:Object.assign(Object.assign({},this._ui?{ui:this._ui}:{}),this._template?{"template-filename":this._template.url}:{})}}get manager(){return this._manager}get cwd(){return this._cwd}set cwd(t){this._cwd=t,this.stateChanged.emit(void 0)}get name(){return this._name}set name(t){this._name=t,this.stateChanged.emit(void 0)}get templates(){const t=this._templateSearchText.trim().split(" ");if(!t.length)return this._templates;let e=[];for(const a of this._templates){let s=0;const n=`${a.label} ${(a.tags||[]).join(" ")}`;for(const e of t)-1!==n.indexOf(e)&&s++;s===t.length&&e.push(a)}return e}get formats(){const t=this._manager.formats.filter((t=>t.isEditable));return t.sort(((t,e)=>t.ext.length-e.ext.length)),t}get format(){return this._format}set format(t){this._format=t,this.stateChanged.emit(void 0)}get ui(){return this._ui}set ui(t){this._ui=t,this.stateChanged.emit(void 0)}get template(){return this._template}set template(t){this._template=t,this.stateChanged.emit(void 0)}set templateSearchText(t){this._templateSearchText=t,this.stateChanged.emit(void 0)}get templateSearchText(){return this._templateSearchText}get settingsUi(){const t=(this._manager.settings.composite||{}).drawioUrlParams||{};return t.ui?t.ui:"kennedy"}get documentRequested(){return this._documentRequested}}t.Model=e}(k||(k={}));const M=async(t,e,a=null)=>await t.exportAs(e);class P{constructor(t){this._formats=new Map,this._trackers=new Map,this._mimeExport=new Map,this._templates=new Map,this._templatesChanged=new w.Signal(this),this._formatsChanged=new w.Signal(this),this._app=t.app,this._restorer=t.restorer,this._palette=t.palette,this._browserFactory=t.browserFactory,this._status=new g.Model,this._initCommands(),this.initTemplates().catch(console.warn)}_initCommands(){const{commands:t}=this._app;t.addCommand(f.OF.createNew,{label:t=>{const{drawioUrlParams:e}=t,{ui:a}=e||{};return a?`${d.Fl.label} [${null==e?void 0:e.ui}]`:d.Fl.label},icon:t=>{const{drawioUrlParams:e}=t,{ui:a}=e||{};return a?d.sc[a]:d.EH},caption:`Create a blank ${d.Fl.ext} file`,execute:async t=>{let e=this._browserFactory.defaultBrowser.model.path;return await this.createNew(Object.assign(Object.assign({},t),{cwd:e}))}}),t.addCommand(f.OF.createNewCustom,{label:`Custom ${d.Fl.label}...`,caption:"Create a diagram with customized formats, templates, and UI",execute:()=>{const e=new k.Model({manager:this}),a=()=>e.stateChanged.emit(void 0),s=()=>e.cwd=n.model.path,{defaultBrowser:n}=this._browserFactory||{};this._settings.changed.connect(a),this._templatesChanged.connect(a),n&&(n.model.pathChanged.connect(s),s());const r=new k(e),o=new i.MainAreaWidget({content:r}),l=new _.PromiseDelegate,c=async()=>l.reject(void 0);return e.documentRequested.connect((async()=>{const r=await t.execute(f.OF.createNew,e.args);this._settings.changed.disconnect(a),this._templatesChanged.disconnect(a),n&&n.model.pathChanged.disconnect(s),o.disposed.disconnect(c),l.resolve(r),o.dispose(),e.dispose()})),o.disposed.connect(c),this._app.shell.add(o),l.promise},icon:d.EH})}get formats(){return[...this._formats.values()]}get formatsChanged(){return this._formatsChanged}formatForModel(t){f.eM&&console.warn("getting format",t);const{path:e}=t;let a="",s=null;for(const n of this._formats.values()){if(null!=n.wantsModel&&n.wantsModel(t))return n;e&&e.endsWith(n.ext)&&n.ext.length>a.length&&(s=n,a=n.ext)}return s||null}get drawioURL(){return b.DRAWIO_URL}get status(){return this._status}set status(t){this._status=t}get settings(){return this._settings}set settings(t){this._settings=t,this._settings.changed.connect(this._onSettingsChanged,this)}get activeWidget(){const{currentWidget:t}=this._app.shell;for(const e of this._trackers.values())if(e.currentWidget===t)return e.currentWidget;return null}async createNew(t){let{cwd:e}=t;const a=(t.format?this._formats.get(t.format):null)||d.Fl;this._status.status=`Creating Diagram in ${e}...`;let s=await this._app.commands.execute("docmanager:new-untitled",{path:e,type:a.contentType||"file",ext:a.ext});t.name&&t.name.trim()&&(s=await this._app.serviceManager.contents.rename(s.path,y.PathExt.join(y.PathExt.dirname(s.path),`${t.name.trim()}${a.ext}`))),this._status.status=`Opening Diagram ${s.path}...`;const n=await this._app.commands.execute("docmanager:open",{path:s.path,factory:a.factoryName});if(t.drawioUrlParams){n.urlParams=t.drawioUrlParams;const e=t.drawioUrlParams["template-filename"];if(e){await n.content.ready;const t=await fetch(e),a=await t.text();n.content.load(a)}}return n}_onSettingsChanged(){this._status.status="settings changed";for(const t of this._trackers.values())t.forEach(this.updateWidgetSettings)}get templatesChanged(){return this._templatesChanged}async templates(){return[...this._templates.values()]}addTemplates(...t){for(const e of t)this._templates.set(e.url,e);this._templatesChanged.emit(void 0)}async initTemplates(){const t=[],e=await fetch(y.URLExt.join(b.DRAWIO_URL,"../templates/index.xml")),a=await e.text(),s=(new DOMParser).parseFromString(a,"application/xml");for(const e of s.querySelectorAll("template")){let a=e.getAttribute("url");if(!a)continue;const[s,n]=a.replace(/.xml$/,"").replace(/_/g," ").split("/").slice(-2);a=y.URLExt.join(b.DRAWIO_URL,"../templates/",a),t.push({url:a,label:n,thumbnail:a.replace(/.xml$/,".png"),tags:[s,"builtin"]})}this.addTemplates(...t)}addFormat(t){if(f.eM&&console.warn(`adding format ${t.name}`,t),this._formats.has(t.key))throw Error(`cannot reregister ${t.key}`);this._formats.set(t.key,t),this._app.docRegistry.addFileType(Object.assign({name:t.name,contentType:t.contentType||"file",displayName:t.label,mimeTypes:[t.mimetype],extensions:[t.ext],icon:t.icon,fileFormat:t.format},t.pattern?{pattern:t.pattern}:{})),t.isExport&&(f.eM&&console.warn(`...export ${t.name}`),this._initExportCommands(t)),this._initTracker(t.modelName,t.factoryName,`drawio-${t.key}`,[t],t.isDefault?[t]:[]),f.eM&&console.warn(`...tracked ${t.name}`),this._formatsChanged.emit(void 0)}updateWidgetSettings(t){t.updateSettings()}escapeCurrent(t){if(this._settings.composite.disableEscapeFocus)return;this._app.shell.activateById(t.id);const{status:e}=this.status;this.status.status="Escaped",setTimeout((()=>this.status.status=e),1e3),window.focus()}_initExportCommands(t){const{ext:e,key:a,format:s,label:n,mimetype:r,icon:i}=t,o=t.save||String,l=async i=>{let l=this._app.shell.currentWidget,c=y.PathExt.basename(l.context.path).replace(/\.dio($|\.(svg|png|ipynb|pdf)$)/,"");this._status.status=`Exporting Diagram ${c} to ${n}...`;const m=await(t.exporter||M)(l.content,a,this._settings);if(null==m)return void(this._status.status=`Failed to export to ${n}... please retry`);this._status.status=`${c} ready, saving...`;let d=await this._app.commands.execute("docmanager:new-untitled",{path:i,type:t.contentType||"file",ext:e});const h=await this._getAvaialablePath(i,c,e);d=await this._app.serviceManager.contents.rename(d.path,h),null!=m&&await this._app.serviceManager.contents.save(d.path,Object.assign(Object.assign({},d),{format:s,mimetype:r,content:o(m)})),this._status.status=`${c} ${n} saved as ${y.PathExt.basename(h)}, launching...`;const u=this._app.docRegistry.preferredWidgetFactories(d.path).map((t=>t.name));u.length&&await this._app.commands.execute("docmanager:open",{factory:u[0],path:d.path}),this._status.status=`${y.PathExt.basename(h)} launched`};this._app.commands.addCommand(`drawio:export-${a}`,{label:t=>t.justLabel?n:`Export ${d.Fl.label} as ${n}`,icon:i,execute:()=>{let t=this._browserFactory.defaultBrowser.model.path;return l(t)},isEnabled:()=>null!=this.activeWidget}),this._palette.addItem({command:`drawio:export-${a}`,category:`${d.Fl.label} Export`})}async _getAvaialablePath(t,e,a,s=99){let n=`${e}ext`;const r={content:!1},{contents:i}=this._app.serviceManager;for(const o in[...Array(s).keys()]){const s=1==o.length?`0${o}`:`${o}`;n=y.PathExt.join(t,o?`${e}-${s}${a}`:`${e}ext`);try{const t=await i.get(n,r);console.warn("Path not available",t)}catch(t){return n}}throw new Error(`Couldn't find a writeable path for ${e}${a}`)}_initTracker(t,e,a,s,n){if(this._trackers.has(a))throw Error(e);const r=new v.m({modelName:t,name:e,fileTypes:s.map((({name:t})=>t)),defaultFor:n.map((({name:t})=>t)),getSettings:()=>this._settings.composite||{},manager:this}),o=new i.WidgetTracker({namespace:a});return this._restorer&&this._restorer.restore(o,{command:"docmanager:open",args:t=>({path:t.context.path,factory:e}),name:t=>t.context.path}).catch(console.warn),r.widgetCreated.connect(((t,e)=>{this._status.status="Loading Diagram...",e.content.frameClicked.connect((()=>{e!==this._app.shell.currentWidget&&e.node.focus()})),e.title.icon=d.EH,e.context.pathChanged.connect((()=>o.save(e))),e.content.frameClicked.connect((t=>{this._app.shell.activateById(e.id),this._status.status=`Editing ${e.context.path}`})),e.context.ready.then((()=>{var t;if(null==e.context.contentsModel)return void console.warn("widget not ready");const{mimetype:a}=e.context.contentsModel,s=null===(t=this._mimeExport.get(a))||void 0===t?void 0:t.icon;null!=s&&(e.title.icon=s),this._status.status=`${e.context.path} ready`})).catch(console.warn),o.add(e).catch(console.warn)})),this._app.docRegistry.addWidgetFactory(r),this._trackers.set(a,o),o}}var S=a(527),j=a(888);const U={id:`${f.NS}:widgets`,requires:[j.IJupyterWidgetRegistry,f.rY],autoStart:!0,activate:(t,e,s)=>{const n={name:f.NS,version:f.q4,exports:async()=>{const t=await Promise.resolve().then(a.bind(a,722));return t.DiagramView.diagrmManager=s,t}};f.eM&&console.warn("registering widgets",n),e.registerWidget(n)}};var O=a(568);const I={activate:function(t,e,a){const s=y.PageConfig.getOption("retroPage"),{commands:n}=t;if(O.DEBUG&&console.warn("retro page is",s),"tree"==s){const t=new i.CommandToolbarButton({commands:n,id:O.CommandIds.createNew});a.defaultBrowser.toolbar.insertItem(2,"new-diagram",t)}else"edit"===s&&t.shell.currentChanged.connect((async a=>{const{currentWidget:s}=t.shell;if(!s||s instanceof O.DiagramDocument)return;const n=s.context;if(!n)return;if(await n.ready,!n.contentsModel)return;const r=e.formatForModel(n.contentsModel);if(!r||!r.isDefault)return;const i=t.docRegistry.getWidgetFactory(r.factoryName);if(!i)return;const o=document.querySelector('link[rel="icon"], link.favicon');o.href=`data:image/svg+xml;utf8,${encodeURIComponent(r.icon.svgstr)}`,o.type="image/svg+xml",t.shell.addClass("jp-IPyDiagram-main"),s.dispose(),await t.commands.execute("docmanager:open",{path:n.path,factory:i.name,options:{ref:"_noref"}})}))},id:`${O.PLUGIN_ID}-retro`,requires:[f.rY],optional:[l.IFileBrowserFactory],autoStart:!0},D=[{activate:function(t,e,a,s,r,i,o,l){const{commands:c}=t,m=new P({app:t,restorer:i,palette:s,browserFactory:e});let h=null;l&&(h=new g(m.status),l.registerStatusItem(`${f.NS}:status`,{item:h,align:"right",rank:3,isActive:()=>null!=m.activeWidget})),r.load(f.Uu).then((t=>{f.eM&&console.warn("settings loaded",t.composite),m.settings=t})).catch((t=>console.error(t))),o&&(o.add({command:f.OF.createNew,rank:1,category:d.Fl.label}),o.add({command:f.OF.createNewCustom,rank:2,category:d.Fl.label})),c.addCommand(f.OF.setUrlParams,{label:t=>{const{drawioUrlParams:e}=t,a=Object.entries(e||{});if(1==a.length&&t.justValue)return a.map((([t,e])=>e)).join(", ");{const t=a.map((([t,e])=>`${t}: ${e}`.trim()),"");return`${d.Fl.label} `+t.join(", ")}},isToggleable:!0,isToggled:t=>{var e,a;const s=(null===(a=null===(e=m.settings)||void 0===e?void 0:e.composite)||void 0===a?void 0:a.drawioUrlParams)||{};for(const[e,a]of Object.entries(t.drawioUrlParams||{}))if(s.hasOwnProperty(e)&&s[e]!==a)return!1;return!0},execute:async t=>{var e,a;const s=(null===(a=null===(e=m.settings)||void 0===e?void 0:e.composite)||void 0===a?void 0:a.drawioUrlParams)||{};await m.settings.set("drawioUrlParams",Object.assign(Object.assign({},s),t.drawioUrlParams))}});for(const t of f.oP)s.addItem({command:f.OF.setUrlParams,args:{drawioUrlParams:{ui:t}},category:`${d.Fl.label} Settings`});if(a){const{fileMenu:t,settingsMenu:e}=a;a.fileMenu.newMenu.addGroup([{command:f.OF.createNew}],40);const s=new n.Menu({commands:c});s.title.label=`${d.Fl.label} Theme`;for(const t of f.oP)s.addItem({command:f.OF.setUrlParams,args:{drawioUrlParams:{ui:t},justValue:!0},type:"command"});const r=new n.Menu({commands:c});r.title.label=`Save and Export ${d.Fl.label} As...`;let i=[];m.formatsChanged.connect((()=>{for(const t of m.formats){const{key:e}=t;i.includes(e)||(i.push(e),r.addItem({command:`drawio:export-${e}`,args:{justValue:!0},type:"command"}))}})),e.addGroup([{submenu:s,type:"submenu"}],f.pj),t.addGroup([{submenu:r,type:"submenu"}],f.pj)}S.RenderedDiagram.manager=m;for(const t of d.t6)m.addFormat(t);return m},id:f.Uu,requires:[l.IFileBrowserFactory,m.IMainMenu,i.ICommandPalette,o.ISettingRegistry],optional:[r.ILayoutRestorer,c.ILauncher,s.IStatusBar],provides:f.rY,autoStart:!0},U,I]}}]);